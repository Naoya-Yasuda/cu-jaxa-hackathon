# クマ出没予測AIシステム 要件定義書

> **プロジェクト名**: JAXA衛星データ × クマ出没リスク予測システム
> **対象地域**: 静岡県（ハッカソン向けプロトタイプ）
> **作成日**: 2026-02-11
> **ステータス**: Draft

---

## 1. システム概要

### 1.1 目的

JAXA衛星データから得られる植生状態・気象条件・地形情報と、過去のクマ目撃データを機械学習モデルで学習し、**静岡県内のクマ出没リスクをメッシュ単位で予測**するWebアプリケーションを構築する。

### 1.2 背景

- 静岡県では2024年度のクマ目撃件数が前年の約3倍（101件/9月時点）に急増
- 主な出没地域: 静岡市葵区（36件）、富士宮市（22件）、小山町（13件）
- 堅果類（ドングリ・ブナ）の凶作年に人里への大量出没が発生する傾向
- 現行の豊凶調査は地上目視が主流 → **衛星データによる広域モニタリング**にポテンシャル

### 1.3 対象種

ニホンツキノワグマ（*Ursus thibetanus japonicus*）
- 静岡県内の個体群: 富士地域個体群、南アルプス個体群
- 静岡県レッドデータブック: 絶滅のおそれのある地域個体群

### 1.4 ユーザー

| ユーザー | 利用シーン |
|---|---|
| 自治体職員（自然保護課） | 注意喚起エリアの特定、パトロール計画 |
| 登山者・アウトドア利用者 | 入山前のリスク確認 |
| 農業従事者 | 農地周辺のリスク把握 |

---

## 2. 予測モデルの時間スケール

### 2.1 ハイブリッド方式（ベースリスク + 日次補正）

| レイヤー | 更新頻度 | データソース | 説明 |
|---|---|---|---|
| **ベースリスク** | 月1回 | NDVI変化量、森林マップ、地形 | 植生の季節変化に基づく中長期リスク |
| **日次補正係数** | 毎日 | 気象データ（気温・降水）、直近の目撃情報 | 天候や直近の活動に基づく短期補正 |
| **最終リスクスコア** | 毎日 | ベース × 日次補正 | ユーザーに表示するスコア（0〜100） |

### 2.2 設計根拠

- NDVI（植生指数）は日単位では大きく変動しないため、月次更新が合理的
- 気温・降水量はクマの日々の行動パターンに直結（雨天時は活動低下等）
- 直近の目撃情報は「そのエリアにクマが来ている」ことの強いシグナル

---

## 3. データ定義と取得方法

### 3.1 衛星データ（JAXA）

| # | データ | ソース | 空間分解能 | 更新頻度 | 取得方法 | 用途 |
|---|---|---|---|---|---|---|
| S1 | **NDVI（植生指数）** | GCOM-C（しきさい）SGLI | ~250m / ~5km | 日次/月次 | JAXA Earth API（登録不要） | 堅果類の豊凶推定、植生活性度 |
| S2 | **森林・非森林マップ** | ALOS-2 PALSAR-2 | ~25m | 年1回 | JAXA Earth API / G-Portal | 森林域の特定、生息適地判定 |
| S3 | **地表面温度（LST）** | GCOM-C SGLI | ~5km | 日次 | JAXA Earth API | 気温補正、冬眠時期推定 |

#### JAXA Earth API 仕様

```
エンドポイント: https://data.earth.jaxa.jp
認証: 不要（登録・APIキー不要）
データ形式: COG (Cloud Optimized GeoTIFF) + STAC準拠
SDK: Python SDK / JavaScript SDK
商用利用: 条件付きで可能
```

#### 代替・補完データ

| データ | ソース | 分解能 | 備考 |
|---|---|---|---|
| Sentinel-2 NDVI | ESA Copernicus | 10m | より高分解能が必要な場合 |
| Tellus統合データ | Tellus (tellusxdp.com) | 混在 | 複数衛星データの統合利用 |

### 3.2 クマ目撃情報

| # | データソース | データ形式 | 取得方法 | 備考 |
|---|---|---|---|---|
| B1 | **くまップ** | JSON | REST API | 群馬県Xenon社提供。全国の目撃・痕跡・被害情報 |
| B2 | **静岡県自然保護課** | PDF / Googleマップ | 自治体提供 or 手動CSV化 | 令和6〜7年度の出没マップ公開中 |
| B3 | **環境省 クマ類情報** | PDF | 手動取得 → CSV変換 | 許可捕獲数・人身被害統計 |
| B4 | **秋田県クマダス** | CSV | オープンデータダウンロード | 学習データ増強用の参考データ |

#### 目撃データのスキーマ（統一フォーマット）

```
sighting_id:    TEXT     -- 一意識別子
date:           DATE     -- 目撃日 (YYYY-MM-DD)
time:           TIME     -- 目撃時刻（不明の場合NULL）
latitude:       FLOAT    -- 緯度 (WGS84)
longitude:      FLOAT    -- 経度 (WGS84)
type:           TEXT     -- 種別: 目撃 / 痕跡 / 被害 / 捕獲
source:         TEXT     -- データソース: kumapp / shizuoka / env_ministry
head_count:     INTEGER  -- 頭数（不明の場合NULL）
description:    TEXT     -- 備考
```

#### ハッカソン向けデータ取得戦略

```
優先度1: くまップAPIからリアルデータ取得を試みる
優先度2: 静岡県公開PDFから主要出没データを手動CSV化
優先度3: 不足分はテストデータ生成スクリプトで補完
```

### 3.3 地理・地形データ

| # | データ | ソース | 分解能 | 取得方法 | 用途 |
|---|---|---|---|---|---|
| G1 | **DEM（標高）** | 基盤地図情報（国土地理院） | 10m | ダウンロード（要登録） | 標高、傾斜角、谷筋の特定 |
| G2 | **土地利用** | 国土数値情報 | 100mメッシュ | ダウンロード | 森林/農地/市街地の分類 |
| G3 | **河川** | 国土数値情報 | ベクター | ダウンロード | 河川沿い移動経路の特定 |
| G4 | **道路** | OpenStreetMap | ベクター | Overpass API | 人里との距離算出 |
| G5 | **高精度地形** | VIRTUAL SHIZUOKA | 0.5m点群 | G空間情報センター | 必要に応じて利用 |

### 3.4 気象データ

| # | データ | ソース | 更新頻度 | 取得方法 | 用途 |
|---|---|---|---|---|---|
| W1 | **気温・降水量** | 気象庁アメダス | 10分毎 | JSON API | 日次補正の入力値 |
| W2 | **積雪深** | 気象庁アメダス | 日次 | JSON API | 冬眠時期の推定 |

### 3.5 テストデータ生成（フォールバック）

実データが不足する場合に備え、以下のルールでリアルな擬似データを生成する:

| パラメータ | 値 | 根拠 |
|---|---|---|
| 配置範囲 | 静岡県内の森林域（標高300〜1500m） | ツキノワグマの主な生息標高帯 |
| 季節パターン | 4〜6月（春）・9〜11月（秋）にピーク | 冬眠明け＆冬眠前の餌探し行動 |
| 地形バイアス | 河川沿い・森林縁部で出現確率UP | 既知のクマ行動パターン |
| 年間件数 | 100〜150件 | 静岡県の近年の実績ベース |
| 空間分布 | 静岡市葵区・富士宮市に集中 | 実際の出没多発地域 |

---

## 4. AIモデル設計

### 4.1 アルゴリズム

**勾配ブースティング（LightGBM）によるメッシュ単位リスク予測**

| 項目 | 選定内容 | 理由 |
|---|---|---|
| アルゴリズム | LightGBM | 表形式データに最適、高速、メモリ効率良好 |
| 代替候補 | XGBoost | LightGBMで問題があれば切り替え |
| 不採用 | ディープラーニング | データ量に対してオーバースペック、解釈性低い |

### 4.2 予測単位

| 項目 | 仕様 |
|---|---|
| 空間単位 | 1km × 1km メッシュ（静岡県 ≈ 約7,800メッシュ） |
| 時間単位 | 日次（ベースリスク月次 × 日次補正係数） |
| 出力 | リスクスコア 0〜100（予測確率をスケーリング） |

### 4.3 特徴量設計

| # | カテゴリ | 特徴量 | データソース |
|---|---|---|---|
| F1 | **植生** | NDVI値、NDVI前月差分、NDVI前年同月差分 | GCOM-C (S1) |
| F2 | **地形** | 標高、傾斜角、谷度指数(TPI)、河川までの距離 | DEM (G1)・国土数値情報 (G3) |
| F3 | **土地利用** | 森林率、農地率、最寄り市街地までの距離、森林縁の長さ | 国土数値情報 (G2) |
| F4 | **気象** | 日平均気温、日降水量、過去7日累積降水量 | アメダス (W1) |
| F5 | **時間** | 月、曜日、祝日フラグ | カレンダー |
| F6 | **履歴** | 同メッシュ過去出没回数、近傍メッシュの直近7日出没数 | 目撃データ (B1-B4) |

### 4.4 ターゲット変数

- 各メッシュ・各日の **出没有無（0 / 1）** → 二値分類問題
- 予測確率（0.0〜1.0）を 0〜100 のリスクスコアに変換して表示

### 4.5 学習パイプライン

```
[データ取得]  →  [前処理・特徴量生成]  →  [学習]  →  [評価]  →  [推論API]
    │                   │                  │          │           │
 scripts/           scripts/           models/    models/      api/
 fetch_*.py      build_features.py    train.py  evaluate.py  predict.py
```

### 4.6 評価指標

| 指標 | 目標値 | 重視度 | 備考 |
|---|---|---|---|
| **AUC-ROC** | 0.7以上 | 主指標 | モデル全体の識別能力 |
| **Recall** | 0.8以上 | 高 | リスクの見逃し防止（安全重視） |
| **Precision** | 0.3以上 | 中 | 過度な誤報抑制 |
| **空間的妥当性** | - | 高 | 既知の出没多発地域との整合性チェック |

---

## 5. システムアーキテクチャ

```
┌──────────────────────────────────────────────────────┐
│                     Frontend                          │
│     OpenStreetMap (Folium / Leaflet.js)               │
│     ┌────────────────────────────────────────────┐    │
│     │  - リスクヒートマップ（メッシュ塗り分け）     │    │
│     │  - 目撃情報マーカー（種別別アイコン）         │    │
│     │  - メッシュクリック → 詳細パネル表示          │    │
│     │  - 日付選択 → リスク再計算                   │    │
│     └────────────────────────────────────────────┘    │
└──────────────────────┬───────────────────────────────┘
                       │ HTTP API (JSON)
┌──────────────────────▼───────────────────────────────┐
│                  Backend (FastAPI)                     │
│                                                       │
│  GET  /                     → 地図UI (HTMLレスポンス)  │
│  GET  /api/risk             → リスクスコア取得         │
│       ?date=YYYY-MM-DD                                │
│       &bounds=lat1,lon1,lat2,lon2                     │
│  GET  /api/sightings        → 目撃情報取得            │
│       ?from=YYYY-MM-DD&to=YYYY-MM-DD                  │
│  GET  /api/mesh/{mesh_id}   → メッシュ詳細            │
│  GET  /api/feature-importance → 特徴量重要度          │
│                                                       │
└───────────┬──────────────────┬────────────────────────┘
            │                  │
┌───────────▼────────┐ ┌───────▼────────────────────────┐
│   AI Model         │ │   Data Pipeline                │
│   (LightGBM)       │ │                                │
│                    │ │   JAXA Earth API  ← 衛星データ  │
│   - 学習済みモデル  │ │   アメダス API    ← 気象データ  │
│   - 推論エンジン    │ │   くまップ API   ← 目撃情報    │
│   - 特徴量重要度    │ │   国土数値情報   ← 地理データ  │
│                    │ │                                │
└────────────────────┘ └────────────────────────────────┘
            │
┌───────────▼────────┐
│   Database         │
│   (SQLite)         │
│                    │
│   - sightings      │
│   - mesh_features  │
│   - predictions    │
│   - weather_daily  │
└────────────────────┘
```

---

## 6. 技術スタック

| レイヤー | 技術 | バージョン | 選定理由 |
|---|---|---|---|
| **言語** | Python | 3.11+ | チーム指定 |
| **Webフレームワーク** | FastAPI | 0.110+ | 高速、型安全、Swagger自動生成 |
| **地図UI** | Folium + Leaflet.js | Folium 0.17+ | OpenStreetMap表示、Pythonから直接生成 |
| **テンプレート** | Jinja2 + HTML/JS | - | React不要で軽量、Folium出力をそのまま配信 |
| **AIモデル** | LightGBM | 4.0+ | 表形式最適、高速、特徴量重要度の解釈性 |
| **地理処理** | GeoPandas, Rasterio, Shapely | - | GeoTIFF / Shapefile処理 |
| **データ取得** | requests, httpx | - | 外部API呼び出し |
| **データ操作** | pandas, numpy | - | データフレーム処理 |
| **DB** | SQLite | 3 | セットアップ不要、ファイルベース |
| **可視化** | matplotlib, plotly | - | 特徴量重要度・評価結果の可視化 |

---

## 7. ディレクトリ構成

```
CU_JAXA/
├── docs/
│   └── requirements_bear_prediction.md   # 本ファイル（要件定義書）
├── requirements.txt                       # Pythonパッケージ一覧
├── config.py                              # 設定（API URL、対象地域、メッシュサイズ等）
│
├── data/
│   ├── raw/                               # 取得した生データ
│   │   ├── jaxa/                         #   NDVI, FNF, LST
│   │   ├── sightings/                    #   目撃情報CSV
│   │   ├── geo/                          #   DEM, 土地利用, 河川
│   │   └── weather/                      #   アメダスデータ
│   ├── processed/                         # 前処理済み・特徴量テーブル
│   └── test/                              # テスト用擬似データ
│
├── scripts/
│   ├── fetch_jaxa.py                      # JAXA衛星データ取得
│   ├── fetch_sightings.py                 # くまップAPI・目撃情報取得
│   ├── fetch_weather.py                   # 気象データ取得
│   ├── fetch_geo.py                       # 地理データ取得・変換
│   ├── generate_test_data.py              # テストデータ生成
│   └── build_features.py                  # メッシュ分割 & 特徴量生成
│
├── models/
│   ├── train.py                           # モデル学習
│   ├── evaluate.py                        # モデル評価（AUC, 混同行列等）
│   └── predict.py                         # 推論（リスクスコア算出）
│
├── api/
│   ├── main.py                            # FastAPIエントリポイント
│   ├── routes/
│   │   ├── risk.py                       #   リスク予測エンドポイント
│   │   └── sightings.py                  #   目撃情報エンドポイント
│   └── templates/
│       └── map.html                       #   Folium生成マップ
│
├── notebooks/
│   └── exploration.ipynb                  # データ探索・可視化用
│
└── tests/
    └── ...                                # ユニットテスト
```

---

## 8. 実装フェーズ

### Phase 1: データパイプライン構築

| # | タスク | ファイル | 成果物 |
|---|---|---|---|
| 1 | JAXA Earth APIからNDVIデータ取得 | `scripts/fetch_jaxa.py` | `data/raw/jaxa/ndvi_*.tif` |
| 2 | くまップAPI / 自治体データから目撃情報取得 | `scripts/fetch_sightings.py` | `data/raw/sightings/sightings.csv` |
| 3 | テストデータ生成スクリプト作成 | `scripts/generate_test_data.py` | `data/test/test_sightings.csv` |
| 4 | 国土数値情報（DEM・土地利用）取得 | `scripts/fetch_geo.py` | `data/raw/geo/` |
| 5 | 気象データ取得 | `scripts/fetch_weather.py` | `data/raw/weather/` |

### Phase 2: 特徴量エンジニアリング & モデル学習

| # | タスク | ファイル | 成果物 |
|---|---|---|---|
| 6 | メッシュ分割 & 特徴量テーブル生成 | `scripts/build_features.py` | `data/processed/features.parquet` |
| 7 | LightGBMモデル学習 & 評価 | `models/train.py`, `evaluate.py` | `models/model.lgb`, 評価レポート |

### Phase 3: API & UI構築

| # | タスク | ファイル | 成果物 |
|---|---|---|---|
| 8 | FastAPI予測エンドポイント構築 | `api/main.py`, `api/routes/` | REST API |
| 9 | Folium地図UI（ヒートマップ + マーカー） | `api/templates/map.html` | インタラクティブ地図 |
| 10 | 統合テスト & デモ準備 | `tests/`, `notebooks/` | デモ動作確認済みシステム |

---

## 9. 検証方法

| # | 検証項目 | 方法 | 合格基準 |
|---|---|---|---|
| V1 | データ取得 | 各fetchスクリプトを実行 | `data/raw/`にファイルが保存される |
| V2 | 特徴量生成 | `build_features.py`出力をnotebookで確認 | 全メッシュに欠損なく特徴量が付与 |
| V3 | モデル精度 | AUC-ROC、混同行列、特徴量重要度を出力 | AUC ≥ 0.7, Recall ≥ 0.8 |
| V4 | E2Eテスト | `uvicorn api.main:app` → ブラウザ操作 | 地図表示 → メッシュ選択 → スコア表示 |
| V5 | 空間妥当性 | 予測マップと実際の出没データを比較 | 静岡市葵区・富士宮市が高リスク |

---

## 10. ハッカソン発表向けポイント

| ポイント | 内容 | インパクト |
|---|---|---|
| **JAXA衛星データの有用性** | 特徴量重要度グラフでNDVIの寄与を可視化 | 衛星データの実用価値を定量的に示す |
| **NDVI時系列ビジュアル** | 静岡県のNDVI季節変化を画像で見せる | 視覚的に衛星データの意味を伝える |
| **Before/After比較** | 衛星データなし vs ありのモデル精度比較 | 衛星データ追加による精度向上を数値で示す |
| **リスクマップデモ** | OpenStreetMap上でインタラクティブに操作 | 実用的なアウトプットとしてのインパクト |
| **社会的意義** | クマ被害の増加傾向と予防の重要性 | プロジェクトの意義を訴求 |

---

## 付録A: 主要データソースURL

| データソース | URL |
|---|---|
| JAXA Earth API | https://data.earth.jaxa.jp |
| G-Portal | https://gportal.jaxa.jp |
| Tellus | https://www.tellusxdp.com |
| くまップ | https://kumapp.net （※要確認） |
| 静岡県クマ情報 | https://www.pref.shizuoka.jp/kurashikankyo/shizenkankyo/wild/1017680.html |
| 環境省クマ情報 | https://www.env.go.jp/nature/choju/effort/effort12/effort12.html |
| 秋田県クマダス | https://ckan.pref.akita.lg.jp/ |
| 基盤地図情報 | https://service.gsi.go.jp/kiban/ |
| 国土数値情報 | https://nlftp.mlit.go.jp/ksj/ |
| 気象庁アメダス | https://www.data.jma.go.jp/developer/index.html |
| Overpass API (OSM) | https://overpass-api.de/api/interpreter |
| G空間情報センター | https://www.geospatial.jp/ckan/ |
